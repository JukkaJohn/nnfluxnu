import lhapdf
import numpy as np
import typing


xarr=np.array([6.7379469990854670E-003,
   7.4465830709243381E-003,
   8.2297470490200302E-003,
   9.0952771016958155E-003,
   1.0051835744633586E-002,
   1.1108996538242306E-002,
   1.2277339903068436E-002,
   1.3568559012200934E-002,
   1.4995576820477703E-002,
   1.6572675401761255E-002,
   1.8315638888734179E-002,
   2.0241911445804391E-002,
   2.2370771856165601E-002,
   2.4723526470339388E-002,
   2.7323722447292569E-002,
   3.0197383422318501E-002,
   3.3373269960326080E-002,
   3.6883167401240015E-002,
   4.0762203978366211E-002,
   4.5049202393557822E-002,
   4.9787068367863944E-002,
   5.5023220056407231E-002,
   6.0810062625217973E-002,
   6.7205512739749784E-002,
   7.4273578214333905E-002,
   8.2084998623898800E-002,
   9.0717953289412512E-002,
  0.10025884372280375,
  0.11080315836233391,
  0.12245642825298195,
  0.13533528323661270,
  0.14956861922263506,
  0.16529888822158656,
  0.18268352405273469,
  0.20189651799465547,
  0.22313016014842982,
  0.24659696394160649,
  0.27253179303401265,
  0.30119421191220219,
  0.33287108369807966,
  0.36787944117144233,
  0.40656965974059933,
  0.44932896411722167,
  0.49658530379140942,
  0.54881163609402661,
  0.60653065971263342,
  0.67032004603563966,
  0.74081822068171799,
  0.81873075307798249,
  0.90483741803595985])

def convolve(fk_filename: str, farr: list[float]):
   FK = np.loadtxt(fk_filename)
   return np.matmul(FK,np.array(farr))
def binsize(filename: str):
   binsize = np.loadtxt(filename)
   return binsize

if __name__ == "__main__":
   fk_filename = "FK_El_numu_p.dat"
   fkp = "FK_El_numu_p.dat"
   fkn = "FK_El_numu_n.dat"
   fkpb = "FK_El_nubmu_p.dat"
   fknb = "FK_El_nubmu_n.dat"
   fnamebin = "../binning/FK_El_binsize.dat"
   p = lhapdf.mkPDF("FASERv_Run3_EPOS+POWHEG_7TeV",0)
   farr = []
   farrb = []
   for x in xarr:
      pdf = p.xfxQ2(14,x,10) /x
      farr.append(pdf)
      print(f"{pdf:.14e}")
      pdf = p.xfxQ2(-14,x,10) /x
      farrb.append(pdf)
   #res = ( 74/183 *convolve(fkp, farr) 
   #      +109/183 *convolve(fkn, farr) 
   #      + 74/183 *convolve(fknb, farrb)
   #      +109/183 * convolve(fkpb, farrb)
   #      ) * binsize(fnamebin)
   #for r in res:
   #   print(f"{r:.14e}")
